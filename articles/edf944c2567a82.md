---
title: "Amazon AppFlowã§BigQueryâ†’S3ã«ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã™ã‚‹"
emoji: "ğŸ«§"
type: "tech"
topics:
  - "aws"
  - "s3"
  - "bigquery"
  - "appflow"
published: true
published_at: "2024-04-24 10:00"
---

Amazon Appflowã‚’ä½¿ã£ã¦BigQueryã®ãƒ‡ãƒ¼ã‚¿ã‚’S3ã«è»¢é€ã—ã¦ã¿ã¾ã—ãŸã€‚

# OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDç™ºè¡Œ
`APIã¨ã‚µãƒ¼ãƒ“ã‚¹ > èªè¨¼æƒ…å ± > èªè¨¼æƒ…å ±ã‚’ä½œæˆ > OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID` ã‹ã‚‰OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ç™ºè¡Œã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/eae41fa0de9f-20240124.png)


â†“ã®æ„Ÿã˜ã§ä½œæˆã—ã¾ã—ãŸã€‚ä½œæˆæ™‚ã«scopeã‚’è¨­å®šã™ã‚‹ã®ã§ã™ãŒã€BigQueryã«é–¢ã™ã‚‹scopeã‚’æŒ‡å®šã—ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/a7b7d94574f1-20240124.png)


# è»¢é€ãƒ‡ãƒ¼ã‚¿
è»¢é€å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦BigQueryã«ä¸‹è¨˜ã®sampleãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
```json:
{"id":"1","first_name":"John","last_name":"Doe","dob":"1968-01-22","addresses":[{"status":"current","address":"123 First Avenue","city":"Seattle","state":"WA","zip":"11111","numberOfYears":"1"},{"status":"previous","address":"456 Main Street","city":"Portland","state":"OR","zip":"22222","numberOfYears":"5"}]}
{"id":"2","first_name":"Jane","last_name":"Doe","dob":"1980-10-16","addresses":[{"status":"current","address":"789 Any Avenue","city":"New York","state":"NY","zip":"33333","numberOfYears":"2"},{"status":"previous","address":"321 Main Street","city":"Hoboken","state":"NJ","zip":"44444","numberOfYears":"3"}]}
```
![](https://storage.googleapis.com/zenn-user-upload/821938fb3e32-20240125.png)

# Appflow
é€ä¿¡å…ƒã‚’BigQueryã«ã€é€ä¿¡å…ˆã¯S3ã«è¨­å®šã—ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/3d9e6d166d70-20240125.png)

ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã¯ä¸€æ—¦å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é¸æŠã—ã¦ã¿ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/01feaa3ffcae-20240125.png)

å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã€ä¸‹è¨˜ã®jsonãƒ•ã‚¡ã‚¤ãƒ«ãŒS3ã«é…ç½®ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ãƒã‚¹ãƒˆã—ã¦ã„ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚ã—ã£ã‹ã‚Šè»¢é€ã•ã‚Œã¦ã„ã¾ã™ã€‚
```json:
{"addresses":[{"numberOfYears":"1","state":"WA","city":"Seattle","zip":"11111","address":"123 First Avenue","status":"current"},{"numberOfYears":"5","state":"OR","city":"Portland","zip":"22222","address":"456 Main Street","status":"previous"}],"first_name":"John","dob":"1968-01-22","last_name":"Doe","id":1}
{"addresses":[{"numberOfYears":"2","state":"NY","city":"New York","zip":"33333","address":"789 Any Avenue","status":"current"},{"numberOfYears":"3","state":"NJ","city":"Hoboken","zip":"44444","address":"321 Main Street","status":"previous"}],"first_name":"Jane","dob":"1980-10-16","last_name":"Doe","id":2}
```

# ãƒ‡ãƒ¼ã‚¿åŠ å·¥
Appflowã§ã¯ãƒ‡ãƒ¼ã‚¿è»¢é€æ™‚ã«ç°¡æ˜“ãªåŠ å·¥ã‚‚ã§ãã‚‹ã‚ˆã†ãªã®ã§è©¦ã—ã¦ã¿ã¾ã™ã€‚

## é€£çµ
fisrt_nameã¨last_nameã‚’é€£çµã—ã¦full_nameã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½œæˆã—ã¦ã¿ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/6fa101a124eb-20240125.png)

![](https://storage.googleapis.com/zenn-user-upload/3e16435b187b-20240125.png)

S3ã«è»¢é€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒä¸‹è¨˜ã§ã™ã€‚full_nameãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
```json:
{"addresses":[{"numberOfYears":"1","state":"WA","city":"Seattle","zip":"11111","address":"123 First Avenue","status":"current"},{"numberOfYears":"5","state":"OR","city":"Portland","zip":"22222","address":"456 Main Street","status":"previous"}],"first_name":"John","dob":"1968-01-22","last_name":"Doe","id":1,"full_name":"John Doe"}
{"addresses":[{"numberOfYears":"2","state":"NY","city":"New York","zip":"33333","address":"789 Any Avenue","status":"current"},{"numberOfYears":"3","state":"NJ","city":"Hoboken","zip":"44444","address":"321 Main Street","status":"previous"}],"first_name":"Jane","dob":"1980-10-16","last_name":"Doe","id":2,"full_name":"Jane Doe"}
```

## ãƒã‚¹ã‚¯/åˆ‡ã‚Šæ¨ã¦
æ¬¡ã«å€¤ã®ãƒã‚¹ã‚¯ã¨åˆ‡ã‚Šæ¨ã¦ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

**ãƒã‚¹ã‚¯**
first_nameã®å…¨æ–‡å­—ã‚’ãƒã‚¹ã‚¯ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/f1d500961549-20240125.png)

![](https://storage.googleapis.com/zenn-user-upload/eb7f28862f6b-20240125.png)

**åˆ‡ã‚Šæ¨ã¦**
last_nameã®2æ–‡å­—ç›®ä»¥é™ã‚’åˆ‡ã‚Šæ¨ã¦ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/36f1d1239638-20240125.png)

![](https://storage.googleapis.com/zenn-user-upload/b967e6951c36-20240125.png)

S3ã«è»¢é€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒä¸‹è¨˜ã§ã™ã€‚first_nameãŒ`*`ã§ãƒã‚¹ã‚¯ã•ã‚Œã€last_nameã¯2æ–‡å­—ç›®ä»¥é™ãŒåˆ‡ã‚Šæ¨ã¦ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚çµåˆå‡¦ç†ã¯ãƒã‚¹ã‚¯/åˆ‡ã‚Šæ¨ã¦ã®å‡¦ç†ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã‚‹ã‚ˆã†ã§ã€full_nameã¯ãƒã‚¹ã‚¯/åˆ‡ã‚Šæ¨ã¦å‰ã®å€¤ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚
```json:
{"addresses":[{"numberOfYears":"1","state":"WA","city":"Seattle","zip":"11111","address":"123 First Avenue","status":"current"},{"numberOfYears":"5","state":"OR","city":"Portland","zip":"22222","address":"456 Main Street","status":"previous"}],"first_name":"****","dob":"1968-01-22","last_name":"D","id":1,"full_name":"John Doe"}
{"addresses":[{"numberOfYears":"2","state":"NY","city":"New York","zip":"33333","address":"789 Any Avenue","status":"current"},{"numberOfYears":"3","state":"NJ","city":"Hoboken","zip":"44444","address":"321 Main Street","status":"previous"}],"first_name":"****","dob":"1980-10-16","last_name":"D","id":2,"full_name":"Jane Doe"}
```

# ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
æœ€å¾Œã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚
ç‰¹å®šã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¯¾ã—ã¦æ¡ä»¶ã‚’è¨­å®šã—ã€æ¡ä»¶ã«åˆè‡´ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’è»¢é€ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

1970/1/1ã‚ˆã‚Šã‚‚å¾Œã®dobã‚’æŒã¤ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’è»¢é€å¯¾è±¡ã«è¨­å®šã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/676aaafb5c19-20240125.png)

S3ã«è»¢é€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒä¸‹è¨˜ã§ã™ã€‚æ¡ä»¶ã«åˆè‡´ã™ã‚‹1ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ãŒè»¢é€ã•ã‚Œã¾ã—ãŸã€‚
```json:
{"addresses":[{"numberOfYears":"2","state":"NY","city":"New York","zip":"33333","address":"789 Any Avenue","status":"current"},{"numberOfYears":"3","state":"NJ","city":"Hoboken","zip":"44444","address":"321 Main Street","status":"previous"}],"first_name":"****","dob":"1980-10-16","last_name":"D","id":2,"full_name":"Jane Doe"}
```

# ã¾ã¨ã‚
Amazon Appflowã‚’ä½¿ã£ã¦BigQueryâ†’S3ã®ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚ä½•ã‹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
